---
comments: true
tags:
    - 主题
    - 颜色主题
    - 适配系统
status: new
---

# §6.1 切换颜色主题

/// warning | 特别说明

本页教程仍在撰写中！如出现有误的地方属于正常现象，请放心“食用”，最多也就程序中毒暴毙而已……

///

## 一、切换颜色主题的方式

`maliang` 支持两种切换颜色主题的方式，手动调用的方式来切换主题和根据系统的主题自动进行适配。

### 1.1 手动切换颜色主题

目前 `maliang` 内置的主题有两套，一套亮色主题 `#!py "light"` 和一套暗色主题 `#!py "dark"`，用户可以通过自定义的方式添加更多主题，名称也不一定要按照什么约定，只要不覆盖内置的主题名称即可。除了内置的两套主题外，还有一个特殊的主题名称不可使用，即后文将提到的 `#!py "system"`。

/// failure | 不推荐自定义主题：不要没苦硬吃

虽然说用户可以通过自定义的方式添加更多主题，但这里我并不推荐这样做。因为这样做的工作量非常大，且难以移植！曾经的 `maliang` 在某个版本的时候可以通过导入 JSON 格式的主题配置文件来自定义主题，但随着后续主题功能的重构升级，这个功能目前已被移除。目前只能通过编写 Python 文件的“样式”类来实现自定义主题，这样做非常麻烦，而且一旦后续版本升级 API 发生某些变动，将导致主题不可用！

所以，这里不推荐自定义主题。那可以怎么办呢？等！等我后续更新……看看什么时候有空把 JSON 格式的主题配置文件加回来。

///

下面是一个简单的示例，它可以强制指定窗口的主题：

```python hl_lines="2 4"
import maliang
from maliang import theme

theme.set_color_mode("light")

root = maliang.Tk(title="登录")

canvas = maliang.Canvas(auto_zoom=True, keep_ratio="min", free_anchor=True)
canvas.place(width=1280, height=720, x=640, y=360, anchor="center")

maliang.Text(canvas, (640, 200), text="账 号 登 录", fontsize=48, anchor="center")

maliang.Text(canvas, (450, 300), text="账号", anchor="nw")
maliang.InputBox(canvas, (450, 340), (380, 50), placeholder="点击输入账号")
maliang.Text(canvas, (450, 400), text="密码", anchor="nw")
maliang.InputBox(canvas, (450, 440), (380, 50), show="●", placeholder="点击输入密码")

maliang.Button(canvas, (450, 540), (180, 50), text="注 册")
maliang.Button(canvas, (650, 540), (180, 50), text="登 录")

root.center()
root.mainloop()
```

同理，你也可以将 `#!py "light"` 更改为 `#!py "dark"` 来强制指定颜色主题为暗色。

设置颜色主题的代码并不一定要放在最前面，你也可以将其放到中间。

### 1.2 自动适配颜色主题

自动适配颜色主题的功能默认是开启的，如果你安装了所需要的可选包。`maliang` 通过调用第三方包 <https://github.com/albertosottile/darkdetect> 来检测系统主题并跟随系统主题的切换进行切换。但其本质上和上面手动切换的方式一样，只不过这个切换操作是由 `maliang` 自动完成的。

但为了防止和手动切换颜色主题的功能产生冲突，当 `maliang` 的主题名称不是 `#!py "system"` 时，自动适配颜色主题的功能不会生效，也就是说，如果通过某种方式手动改变了应用程序的主题，那么自动适配的功能会失效，只有重新将主题设为 `#!py "system"` 才会重新生效。

下面是一个示例程序，运行后出现一个分段按钮，你尝试选择不同的主题后查看窗口的变化，并时不时地修改系统的主题，再看看窗口会发生什么变化：

```python hl_lines="5-6 13"
import maliang
from maliang import theme


def _set_color_mode(index: int) -> None:
    theme.set_color_mode(["light", "system", "dark"][index])


root = maliang.Tk()
canvas = maliang.Canvas()
canvas.pack(fill="both", expand=True)

maliang.SegmentedButton(canvas, (20, 20), text=("light", "system", "dark"), default=1, command=_set_color_mode)

root.mainloop()
```

想必你现在应该已经理解它的逻辑了。

## 二、为主题切换绑定关联函数

`maliang` 还提供了在主题切换时触发已注册的函数的功能。

未完待续……
