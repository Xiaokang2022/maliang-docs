---
comments: true
tags:
    - 窗口创建
    - 画布处理
---

# §1.1 初始窗口实现

## 一、环境搭建及安装

![maliang3.0-rc6](https://img.shields.io/badge/Maliang-3.0-green)

具体环境及 `maliang` 安装请参考官方教程 1.1

建议您完整安装 `maliang` 。

!!! warning "必要安装"
    
    您必须安装 `maliang-extension` ，因为这是本项目的必要库！

## 二、初始化项目和创建窗口

### 2.1 创建项目及文件分工

在这个项目中，我们至少需要一个主程序所在的文件，即 `main.py`，而为了后期维护方便，我们还需要一个 `functions.py` 来放帮助函数和 `data.py` 
来放主要数据。为了资源文件管理方便，您可以在项目根文件夹处创建一个专用文件夹 `assets` 。

所以在完成文件创建后，您的项目目录应是这样的：

<p style="margin-bottom: -15px"><i><small>代码清单1.1.1 目录结构</small></i></p>

```
└ <your_project_name>
  └ assets
    └ <your_resource_files>
  └ data.py
  └ functions.py
  └ main.py
```

### 2.2 导入 `maliang` 及创建初始窗口

在 2.1 节中，您应该已经创建好了项目，现在打开 `main.py` 并从 `functions.py` 导入其全部内容，这样方便我们快速使用我们在 `functions.py` 
中创建的函数。 接下来，再导入 `maliang` 库，并将其重命名为 `ml` 以方便书写。 

然后我们来创建一个720×360的窗口设置其名称后将其居中，然后关闭窗口大小调整，将其置顶。

<p style="margin-bottom: -15px"><i><small>代码清单1.1.2 创建窗口</small></i></p>

```python
from functions import *
import maliang as ml

# Initialize window
root = ml.Tk((720, 360), title="抽人")
root.center()
root.resizable(False, False)
root.topmost(True)

root.runloop()
```

![](images/1-1.light.png#only-light)
![](images/1-1.dark.png#only-dark)

<p align="center"><small>图1.1.1 代码清单1.1.2实现效果</small></p>

### 2.3 实现关闭窗口时提示

根据官方教程，我们需要一个函数来响应关闭事件。因此，在 `functions.py` 文件中新建一个函数，代码如下：

<p style="margin-bottom: -15px"><i><small>代码清单1.1.3 关闭窗口函数</small></i></p>

```python
from tkinter import messagebox

def get_exit_ask(root_window):
    root_win = root_window

    def exit_ask():
        if messagebox.askyesno("退出", "您确定要退出软件吗？"):
            root_win.destroy()

    return exit_ask
```

在在这段代码中，为了方便，直接导入了 `tkinter.messagebox` 来实现对话框。

首先，我们定义了一个名为 `get_exit_ask` 的函数，它接受一个参数 `root_window`，这个参数代表程序的主窗口。然后将传入的 `root_window` 参数赋
值给局部变量 `root_win`，这样在函数内部就可以通过 `root_win` 来引用主窗口对象了。

从代码中可以看出，该函数还封装了一个内嵌函数 `exit_ask`，而这个函数使用 messagebox.askyesno 函数显示一个带有“是”和“否”按钮的询问对话框。
对话框的标题是“退出”，内容是“您确定要退出软件吗？”。如果用户选择了“是”，就调用 root_win.destroy() 方法来销毁主窗口，从而关闭程序。

然后我们再将这个函数设置为关闭时调用即可。

<p style="margin-bottom: -15px"><i><small>代码清单1.1.4 设置关闭窗口时调用</small></i></p>

```python
from functions import *
import maliang as ml

# Initialize window
root = ml.Tk((720, 360), title="抽人")
root.center()
root.resizable(False, False)
root.topmost(True)
root.at_exit(get_exit_ask(root), ensure_destroy=False)

root.mainloop()
```

如上， `maliang` 为我们提供了一个很方便的函数 `at_exit` ，这使得我们不需要再使用 `portocol` 来绑定事件。

## 三、画布布置

### 3.1 设计说明

对于画布，我想将所有主界面的子画布都放到一个基画布上，因为这样更方便实现其他画面切换，如设置页面。

### 3.2 画布设置

看以下代码。

<p style="margin-bottom: -15px"><i><small>代码清单1.1.5 画布设置</small></i></p>

```python
# Initialize base canvas
cav = ml.Canvas(root, bg="white")
cav.place(width=720, height=360)

# Initialize header canvas
header_cav = ml.Canvas(cav, bg="white")
header_cav.place(width=720, height=60, y=0)

# Initialize body canvas
sub_cav_1 = ml.Canvas(cav, bg="white")
sub_cav_1.place(width=720, height=300, x=0, y=60)
sub_cav_2 = ml.Canvas(cav, bg="white")
sub_cav_2.place(width=720, height=300, x=720, y=60)
```

在上述代码中，我们创建了一个基画布 `cav` 和三个子画布 `header_cav` `sub_cav_1` `sub_cav_2`。这三个子画布作用分别是：头，独立出来防止切
换页面时移动；子1，用来放抽人代码；子2，用来放抽卡代码。
